## **Скрипт настройки OpenSSH для Windows**

Этот PowerShell-скрипт автоматизирует установку и настройку OpenSSH-сервера на Windows-системах с повышенными мерами безопасности.

## **Основные функции**

1. **Создание защищенного административного аккаунта**:

   -  Специальный пользователь `special_user_ssh`

   -  Скрытие аккаунта на экране входа

   -  Требование сложного пароля (8+ символов, разные регистры, цифры, спецсимволы)

2. **Настройка OpenSSH-сервера**:

   -  Установка через Windows Capabilities

   -  Смена стандартного порта (12345 вместо 22)

   -  Ограничение доступа по IP-адресам

3. **Конфигурация брандмауэра**:

   -  Создание правила для нестандартного порта

   -  Ограничение доступа только для доверенных IP

## **Предварительные требования**

-  Windows 10/11 или Windows Server 2016+

-  Требуются права администратора

-  Доступ в интернет для загрузки компонентов

## **Использование**

1. Сохраните скрипт как `sshd_config_ps.ps1`

2. **Обязательно измените параметры в начале скрипта**:

   powershell


   ```
   $admin_username = "special_user_ssh"  # Имя пользователя
   $ssh_port = 12345                   # Порт SSH
   $allowed_ips = @(                   # Разрешенные IP/подсети
       "10.11.12.13",
       "192.168.88.99",
       "172.16.32.25"
   )
   ```

3. Запустите от имени администратора:

   powershell


   ```
   .\sshd_config_ps.ps1
   ```

## **Особенности работы**

### **Варианты установки пароля**

1. **Интерактивный ввод (рекомендуется)**:

   -  Скрипт запросит пароль при запуске

   -  Пароль не сохраняется в системе

2. **Прямое указание в скрипте (небезопасно)**:

   -  Раскомментируйте строку `$plain_password`

   -  Установите пароль в открытом виде

   -  **Не рекомендуется для продакшн-сред**

### **Последовательность выполнения**

1. Создание/настройка пользователя

2. Установка OpenSSH Server

3. Конфигурация SSH (`sshd_config`)

4. Настройка брандмауэра Windows

5. Перезапуск SSH-службы

## **Важные предупреждения**

1. **Безопасность пароля**:

   -  При использовании `$plain_password` пароль остается в скрипте

   -  Предпочтительно использовать интерактивный ввод

2. **Ограничения формата IP**:

   -  Поддерживается только IPv4

   -  Для одиночных IP автоматически применяется маска /32

   -  Для подсетей используйте CIDR-нотацию (например, `192.168.1.0/24`), но не смешивайте её с указанием IP без подсети

3. **Перезапись существующих настроек**:

   -  Существующие правила брандмауэра с именем `OpenSSH_CustomPort` будут удалены

   -  Стандартное правило брандмауэра Windows для OpenSSH останется неизменным, но фактически не будет работать из-за смены порта SSH

## **Рекомендации**

1. **Просмотр статуса службы**:

   powershell

 
   ```
   Get-Service sshd | Select-Object Name, Status
   ```


2. **Проверка подключения с доверенного хоста**:

   bash


   ```
   ssh -p 12345 special_user_ssh@<server_ip>
   ```


## 
